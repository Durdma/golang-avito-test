TODO Не забыть про валидацию, в особенности двух списков, что нет повт значений

Переделать структуру под добавление поля ttl для slugsListToAdd
type CreateUser struct {
	UserId         int      `json:"user_id"`
	SlugsListToAdd []string `json:"slugs_list_to_add,omitempty"`
	SlugsListToDel []string `json:"slugs_list_to_del,omitempty"`
	CreatedAt      string   `gorm:"type:varchar(150);not null" json:"created_at,omitempty"`
	UpdatedAt      string   `gorm:"type:varchar(150);not null" json:"updated_at,omitempty"`
}
================================================================================
TODO Зарефакторить поиск, когда нужно извлечь лишь определнные поля
аналогично этому коду

type slugName struct {
		SlugName string
	}

	var slug slugName

result := ur.dbHandler.Model(&models.Slug{}).Where("slug_id = ?", userSlug.SlugSlugID).First(&slug)
===============================================================================

Основное задание (минимум):

1) Метод создания сегмента. Принимает slug (название) сегмента. +
2) Метод удаления сегмента. Принимает slug (название) сегмента. +
3) Метод добавления пользователя в сегмент. Принимает список slug (названий) сегментов которые нужно добавить пользователю, список slug (названий) сегментов которые нужно удалить у пользователя, id пользователя. +- (добавить сравнение списков на повторяющиеся элементы)
4) Метод получения активных сегментов пользователя. Принимает на вход id пользователя. +

+++Доп. задание 1:

Иногда пользователи приходят в поддержку и спрашивают почему у них пропал/появился какой-то новый функционал. Нужно иметь возможность посмотреть когда точно пользователь попал в конкретный сегмент.

Задача: реализовать сохранение истории попадания/выбывания пользователя из сегмента с возможностью получения отчета по пользователю за определенный период. На вход: год-месяц. На выходе ссылка на CSV файл.

Пример отчета:

идентификатор пользователя 1;сегмент1;операция (добавление/удаление);дата и время

идентификатор пользователя 1;сегмент2;операция (добавление/удаление);дата и время

идентификатор пользователя 2;сегмент3;операция (добавление/удаление);дата и время

+++Доп. задание 2:

Бывают ситуации когда нам нужно добавить пользователя в эксперимент на ограниченный срок. Например выдать скидку всего на 2 дня.

Задача: реализовать возможность задавать TTL (время автоматического удаления пользователя из сегмента)

Пример: Хотим чтобы пользователь попал в сегмент на 2 дня - для этого в метод добавления сегментов пользователю передаём время удаления пользователя из сегмента отдельным полем

Доп. задание 3:

Мы хотим добавлять пользователя в сегмент не в ручную, а автоматически. В сегмент будет попадать заданный процент пользователей.

Задача: в методе создания сегмента, добавить опцию указания процента пользователей, которые будут попадать в сегмент автоматически. В методе получения сегментов пользователя, добавленный сегмент должен отдаваться у заданного процента пользователей.

Пример: создали сегмент AVITO_VOICE_MESSAGES и указали что 10% пользователей будут попадать в него автоматически. Пользователь 1000 попал в этот сегмент автоматически. При запросе сегментов пользователя 1000, сегмент AVITO_VOICE_MESSAGES должен отдаваться всегда.

через планировщик каждую минуту считаем сколько всего пользователей -> для каждого сегмента с процентом считаем кол-во юзеров -> считаю необходимое кол-во людей (процент передаем целым числом, далее домнажаем его на 0.01 общее кол-во юзеров умножаем на это значение получаем необходимое кол-во юзеров) -> сравниваю имеющееся кол-во с необходимым -> добавляю недостающее кол-во пользователей.